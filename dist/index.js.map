{"version":3,"sources":["../src/index.ts"],"names":["run","docsFolder","s","token","context","d","wikiUrl","exec","markdownFiles","glob","imageFiles","imagePath","relativePath","i","destPath","e","mdFile","content","updateImageLinks","error","match","alt","newPath","command","args","execCallback"],"mappings":"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","file":"index.js","sourcesContent":["import * as core from \"@actions/core\";\nimport * as github from \"@actions/github\";\nimport * as fs from \"node:fs/promises\";\nimport * as path from \"node:path\";\nimport { glob } from \"glob\";\nimport { exec as execCallback } from \"@actions/exec\";\n\nasync function run(): Promise<void> {\n  try {\n    const docsFolder = core.getInput(\"docs-folder\", { required: true });\n    const token = core.getInput(\"github-token\", { required: true });\n    const context = github.context;\n\n    // Clone the wiki repository\n    const wikiUrl = `https://x-access-token:${token}@github.com/${context.repo.owner}/${context.repo.repo}.wiki.git`;\n    await exec(\"git\", [\"clone\", wikiUrl, \"wiki-repo\"]);\n\n    // Get all markdown and image files\n    const markdownFiles = await glob(`${docsFolder}/**/*.md`);\n    const imageFiles = await glob(`${docsFolder}/**/*.{png,jpg,jpeg,gif,svg}`);\n\n    // Copy images to wiki repository\n    for (const imagePath of imageFiles) {\n      const relativePath = path.relative(docsFolder, imagePath);\n      const destPath = path.join(\"wiki-repo\", relativePath);\n\n      await fs.mkdir(path.dirname(destPath), { recursive: true });\n      await fs.copyFile(imagePath, destPath);\n    }\n\n    // Process and copy markdown files\n    for (const mdFile of markdownFiles) {\n      const relativePath = path.relative(docsFolder, mdFile);\n      const destPath = path.join(\"wiki-repo\", relativePath);\n\n      let content = await fs.readFile(mdFile, \"utf8\");\n\n      // Update image links to use wiki format\n      content = updateImageLinks(content, path.dirname(relativePath));\n\n      await fs.mkdir(path.dirname(destPath), { recursive: true });\n      await fs.writeFile(destPath, content);\n    }\n\n    // Commit and push changes\n    await exec(\"git\", [\"-C\", \"wiki-repo\", \"add\", \".\"]);\n    await exec(\"git\", [\n      \"-C\",\n      \"wiki-repo\",\n      \"config\",\n      \"user.name\",\n      \"GitHub Action\",\n    ]);\n    await exec(\"git\", [\n      \"-C\",\n      \"wiki-repo\",\n      \"config\",\n      \"user.email\",\n      \"action@github.com\",\n    ]);\n    await exec(\"git\", [\n      \"-C\",\n      \"wiki-repo\",\n      \"commit\",\n      \"-m\",\n      \"Update wiki content\",\n    ]);\n    await exec(\"git\", [\"-C\", \"wiki-repo\", \"push\"]);\n  } catch (error) {\n    if (error instanceof Error) {\n      core.setFailed(error.message);\n    }\n  }\n}\n\nfunction updateImageLinks(content: string, relativePath: string): string {\n  // Update image markdown links to use correct wiki paths\n  return content.replace(/!\\[(.*?)\\]\\((.*?)\\)/g, (match, alt, imagePath) => {\n    if (imagePath.startsWith(\"http\")) {\n      return match; // Don't modify external URLs\n    }\n\n    const newPath = path.join(relativePath, imagePath);\n    return `![${alt}](${newPath})`;\n  });\n}\n\nasync function exec(command: string, args: string[]): Promise<void> {\n  await execCallback(command, args);\n}\n\nrun();\n\nexport { updateImageLinks };\n"]}